<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-11-23 Sat 12:07 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Basic statistics exercises (survival analysis)</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Thomas A. Gerds" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://publicifsv.sund.ku.dk/~tag/styles/practicals.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<p class="course-menu"><a accesskey="h" href="https://publicifsv.sund.ku.dk/~tag/Teaching/BasicStats/homepage/index.html">Home</a>&nbsp;<a accesskey="l" href="https://publicifsv.sund.ku.dk/~tag/Teaching/BasicStats/homepage/Lecturenotes.html">Lecturenotes</a>&nbsp;<a accesskey="p" href="https://publicifsv.sund.ku.dk/~tag/Teaching/BasicStats/homepage/Practicals.html">Practicals</a>&nbsp;<a accesskey="p" href="https://publicifsv.sund.ku.dk/~tag/Teaching/share/R-tutorials/index.html">R-tutorials</a></p><div id="content">
<h1 class="title">Basic statistics exercises (survival analysis)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgdd27de6">Tutorial</a></li>
<li><a href="#org1a97ff4">Lung cancer data</a>
<ul>
<li><a href="#orgc724343">Create a new status variable</a></li>
<li><a href="#org2347ddf">Univariate Kaplan-Meier</a></li>
<li><a href="#org8194396">stratified Kaplan-Meier</a></li>
<li><a href="#orgb945fd1">Univariate Cox regression</a></li>
<li><a href="#org7e3e60c">Age-adjusted Cox regression</a></li>
</ul>
</li>
<li><a href="#org98e031c">Time to pregnancy data</a>
<ul>
<li><a href="#orgb8087e9">Effect of smoking (KaplanMeier &amp; logRank)</a>
<ul>
<li><a href="#org9da2e63">woman smoking</a></li>
<li><a href="#org83c0e5b">man smoking</a></li>
<li><a href="#orgb492421">Univariate Cox regression</a></li>
<li><a href="#org9d1ee3c">Interaction</a></li>
</ul>
</li>
<li><a href="#org78d595f">Effect of alcohol (Cox regression)</a>
<ul>
<li><a href="#org8da31dd">Continuous alcohol variable</a></li>
<li><a href="#orgdd164d2">Adjusted analyses</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgdd27de6" class="outline-2">
<h2 id="orgdd27de6">Tutorial</h2>
<div class="outline-text-2" id="text-orgdd27de6">
<p>
<a href="https://publicifsv.sund.ku.dk/~tag/Teaching/share/R-tutorials/Advanced-statistics/SurvivalAnalysis.html">Survival analysis</a>
</p>
</div>
</div>
<div id="outline-container-org1a97ff4" class="outline-2">
<h2 id="org1a97ff4">Lung cancer data</h2>
<div class="outline-text-2" id="text-org1a97ff4">
<p>
Load the data "lung" from the survival package.
</p>

<ul class="org-ul">
<li>Create a new status variable that fits to the standard coding 0 for censored and 1 for event (death).</li>
<li>Compute the Kaplan-Meier estimate of the overall survival curves and plot the results.</li>
<li>Read-off the median survival time from the graph.</li>
<li>Compute the Kaplan-Meier estimate of the survival curves in strata defined by patients gender and visualize the results</li>
<li>Use a Cox regression model to assess if the survival chances are gender dependent.</li>
<li>State the findings in a sentence using hazard ratio with 95% confidence interval and the corresponing p-value.</li>
<li>Adjust the results for patient age and revise the result sentence</li>
</ul>
</div>

<div id="outline-container-orgc724343" class="outline-3">
<h3 id="orgc724343">Create a new status variable</h3>
<div class="outline-text-3" id="text-orgc724343">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(survival)
<span style="color: #008b8b;">library</span>(prodlim)
<span style="color: #008b8b;">library</span>(data.table)
data(lung)
setDT(lung)
lung[,Status:=as.numeric(status==2)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org2347ddf" class="outline-3">
<h3 id="org2347ddf">Univariate Kaplan-Meier</h3>
<div class="outline-text-3" id="text-org2347ddf">
<p>
Compute the Kaplan-Meier estimate of the overall survival curves and
plot the result:
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(prodlim)
KaplanMeierEst = prodlim(Surv(time,Status)~1,data=lung)
plot(KaplanMeierEst,xlab=<span style="color: #8b2252;">"Days"</span>)
</pre>
</div>


<div class="figure">
<p><img src="LungCancer-KaplanMeier-overall.png" alt="LungCancer-KaplanMeier-overall.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-R">quantile(KaplanMeierEst)
</pre>
</div>

<pre class="example">
X11cairo 
       2
Quantiles of the event time distribution based on the   method.

Table of quantiles and corresponding confidence limits:
     q quantile lower upper
1 0.00       NA    NA    NA
2 0.25      550   457   643
3 0.50      310   284   361
4 0.75      170   145   197
5 1.00        5     5    11
Median time (IQR):310.00 (170.00;550.00)
</pre>

<p>
According to the Kaplan-Meier estimate the median survival time (95%
confidence limits) is 310 days (284;361).
</p>
</div>
</div>

<div id="outline-container-org8194396" class="outline-3">
<h3 id="org8194396">stratified Kaplan-Meier</h3>
<div class="outline-text-3" id="text-org8194396">
<p>
Compute the Kaplan-Meier estimate of the survival curves in strata
defined by patients gender and visualize the result:
</p>

<div class="org-src-container">
<pre class="src src-R">KaplanMeierEstStrata = prodlim(Surv(time,Status)~sex,data=lung)
plot(KaplanMeierEstStrata,xlab=<span style="color: #8b2252;">"Days"</span>,confint=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>


<div class="figure">
<p><img src="LungCancer-KaplanMeier-sex.png" alt="LungCancer-KaplanMeier-sex.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgb945fd1" class="outline-3">
<h3 id="orgb945fd1">Univariate Cox regression</h3>
<div class="outline-text-3" id="text-orgb945fd1">
<p>
Use a Cox regression model to assess if the survival chances are gender
dependent:
</p>

<div class="org-src-container">
<pre class="src src-R">coxfit = coxph(Surv(time,Status)~sex,data=lung)
summary(coxfit)
</pre>
</div>

<pre class="example">
X11cairo 
       2
Call:
coxph(formula = Surv(time, Status) ~ sex, data = lung)

  n= 228, number of events= 165 

       coef exp(coef) se(coef)      z Pr(&gt;|z|)   
sex -0.5310    0.5880   0.1672 -3.176  0.00149 **
---
codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

    exp(coef) exp(-coef) lower .95 upper .95
sex     0.588      1.701    0.4237     0.816

Concordance= 0.579  (se = 0.022 )
Rsquare= 0.046   (max possible= 0.999 )
Likelihood ratio test= 10.63  on 1 df,   p=0.001
Wald test            = 10.09  on 1 df,   p=0.001
Score (logrank) test = 10.33  on 1 df,   p=0.001
</pre>


<div class="org-src-container">
<pre class="src src-R">lung$Sex <span style="color: #008b8b;">&lt;-</span> factor(lung$sex,levels=c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>),labels=c(<span style="color: #8b2252;">"Male"</span>,<span style="color: #8b2252;">"Female"</span>))
lung$Sex <span style="color: #008b8b;">&lt;-</span> relevel(lung$Sex,<span style="color: #8b2252;">"Female"</span>)
coxfit = coxph(Surv(time,Status)~Sex,data=lung)
publish(coxfit,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-left">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-left">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Sex</td>
<td class="org-left">Female</td>
<td class="org-left">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Male</td>
<td class="org-left">1.70</td>
<td class="org-left">[1.23;2.36]</td>
<td class="org-left">0.00149</td>
</tr>
</tbody>
</table>

<p>
State the findings in a sentence using hazard ratio with 95% confidence
interval and the (Wald test) p-value.
</p>

<p>
The survival chances were significantly lower for men as compared to
women (hazard ratio: 1.7; 95% confidence interval: [1.2;2.4]; Wald
test p-value: 0.001).
</p>
</div>
</div>

<div id="outline-container-org7e3e60c" class="outline-3">
<h3 id="org7e3e60c">Age-adjusted Cox regression</h3>
<div class="outline-text-3" id="text-org7e3e60c">
<div class="org-src-container">
<pre class="src src-R">coxfit.adj = coxph(Surv(time,Status)~Sex+age,data=lung)
publish(coxfit.adj,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-right">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-right">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Sex</td>
<td class="org-left">Female</td>
<td class="org-right">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Male</td>
<td class="org-right">1.67</td>
<td class="org-left">[1.20;2.32]</td>
<td class="org-right">0.00218</td>
</tr>

<tr>
<td class="org-left">age</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">1.02</td>
<td class="org-left">[1.00;1.04]</td>
<td class="org-right">0.06459</td>
</tr>
</tbody>
</table>

<p>
Cox regression adjusted for age showed that the survival chances were
significantly lower for men as compared to women (hazard ratio: 1.67;
95% confidence interval: [1.2;2.32]; Wald test p-value: 0.002).
</p>
</div>
</div>
</div>

<div id="outline-container-org98e031c" class="outline-2">
<h2 id="org98e031c">Time to pregnancy data</h2>
<div class="outline-text-2" id="text-org98e031c">
<p>
Load the <a href="https://publicifsv.sund.ku.dk/~tag/Teaching/share/data/ttp.html">ttp</a> data.
</p>

<ul class="org-ul">
<li>Analyse the effect of smoking (separately for the woman and the man) on the time-to-pregnancy with Kaplan-Meier curves.</li>
<li>Test the smoking effect with a simple Cox regression model. Write a conclusion sentence which includes the hazard ratio and the corresponding confidence interval and p-value.</li>
<li>Study the interaction of the smoking status of the woman and the smoking status of the man on the time to pregancy. In this model, what is the hazard ratio between a non-smoking couple and a couple where both partners smoke?</li>
<li>Analyse the effect of the woman's alcohol drinking behaviour (''alcWoman'') in a Cox regression analysis. Write a conclusion sentence which includes the hazard ratio and confidence limits.</li>
<li>Categorize the number of beverages per week into three groups:  
<ul class="org-ul">
<li>group 1 (''no''): 0 drinks</li>
<li>group 2 (''moderate''): 1-10 drinks</li>
<li>group 3 (''high''): 11 or more drinks</li>
</ul></li>
</ul>

<p>
Then analyse the effect of this three group variable on the time to pregnancy. Write conclusion sentences which include pairwise comparisons in terms of hazard ratios of all three groups. 
</p>
<ul class="org-ul">
<li>Adjust the previous analysis of alcohol effect for possible confounding by smoking and revise the results.</li>
<li>Adjust the previous analysis of alcohol effect for possible confounding by sperm concentration and revise the results. Find possible explanations for why the results differ from the univariate analysis.</li>
</ul>
</div>

<div id="outline-container-orgb8087e9" class="outline-3">
<h3 id="orgb8087e9">Effect of smoking (KaplanMeier &amp; logRank)</h3>
<div class="outline-text-3" id="text-orgb8087e9">
</div>
<div id="outline-container-org9da2e63" class="outline-4">
<h4 id="org9da2e63">woman smoking</h4>
<div class="outline-text-4" id="text-org9da2e63">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">par</span>(mar=c(10,10,5,5))
fw <span style="color: #008b8b;">&lt;-</span> prodlim(Surv(ttp,status)~smokeWoman,data=ttp)
plot(fw,
     type=<span style="color: #8b2252;">"cuminc"</span>,
     ylab=<span style="color: #8b2252;">"Probability of getting pregnant"</span>,
     legend.title=<span style="color: #8b2252;">"Woman smoking"</span>,
     atrisk.title=<span style="color: #8b2252;">"Woman smoking"</span>,
     legend.x=<span style="color: #8b2252;">"topleft"</span>,
     atrisk.at=seq(0,200,50),
     atrisk.pos=-20,
     xlab=<span style="color: #8b2252;">"Days"</span>)
</pre>
</div>


<div class="figure">
<p><img src="ttp-KaplanMeier-smoke.png" alt="ttp-KaplanMeier-smoke.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-R">logRankWoman <span style="color: #008b8b;">&lt;-</span> survdiff(Surv(ttp,status)~smokeWoman,data=ttp)
publish(logRankWoman,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<pre class="example">
X11cairo 
       2
 Log-rank test      N Observed Expected squared(O-E)/E squared(O-E)/V 
 smokeWoman=No 300.00   194.00   176.46           1.74           5.64 
 smokeWoman=Yes 123.00    62.00    79.54           3.87           5.64 

 Chisq= 5.6  on 1 degrees of freedom, p= 0.0176
</pre>



<p>
The chance of getting pregnant was significantly higher when the woman
was not smoking compared to when the woman was smoking (Log-rank
p-value: 0.0176).
</p>
</div>
</div>
<div id="outline-container-org83c0e5b" class="outline-4">
<h4 id="org83c0e5b">man smoking</h4>
<div class="outline-text-4" id="text-org83c0e5b">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">par</span>(mar=c(10,10,5,5))
fm <span style="color: #008b8b;">&lt;-</span> prodlim(Surv(ttp,status)~smokeMan,data=ttp)
plot(fm,
     type=<span style="color: #8b2252;">"cuminc"</span>,
     ylab=<span style="color: #8b2252;">"Probability of getting pregnant"</span>,
     legend.x=<span style="color: #8b2252;">"topleft"</span>,
     legend.title=<span style="color: #8b2252;">"Man smoking"</span>,
     atrisk.title=<span style="color: #8b2252;">"Man smoking"</span>,
     atrisk.at=seq(0,200,50),
     atrisk.pos=-20,
     xlab=<span style="color: #8b2252;">"Days"</span>)
</pre>
</div>


<div class="figure">
<p><img src="ttp-KaplanMeier-smokeM.png" alt="ttp-KaplanMeier-smokeM.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-R">logRankMan <span style="color: #008b8b;">&lt;-</span> survdiff(Surv(ttp,status)~smokeMan,data=ttp)
publish(logRankMan,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<pre class="example">
X11cairo 
       2
 Log-rank test      N Observed Expected squared(O-E)/E squared(O-E)/V 
 smokeMan=No 290.00   183.00   172.31           0.66           2.04 
 smokeMan=Yes 133.00    73.00    83.69           1.37           2.04 

 Chisq= 2  on 1 degrees of freedom, p= 0.1536
</pre>


<p>
The chance of getting pregnant was higher when the man was not smoking
compared to when the man was smoking (see Kaplan-Meier plot), however,
this difference was not statistically significant (Log-rank p-value:
0.1536).
</p>
</div>
</div>

<div id="outline-container-orgb492421" class="outline-4">
<h4 id="orgb492421">Univariate Cox regression</h4>
<div class="outline-text-4" id="text-orgb492421">
<div class="org-src-container">
<pre class="src src-R">coxWoman <span style="color: #008b8b;">&lt;-</span> coxph(Surv(ttp,status)~smokeWoman,data=ttp)
publish(coxWoman,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-left">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-left">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">smokeWoman</td>
<td class="org-left">No</td>
<td class="org-left">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Yes</td>
<td class="org-left">0.71</td>
<td class="org-left">[0.53;0.94]</td>
<td class="org-left">0.0182</td>
</tr>
</tbody>
</table>

<p>
Smoking of the woman decreased the hazard and hence increased the time
to pregnancy significantly (hazard ratio=0.71, 95%-CI=[0.53;0.94],
p=0.018).
</p>

<div class="org-src-container">
<pre class="src src-R">coxMan <span style="color: #008b8b;">&lt;-</span> coxph(Surv(ttp,status)~smokeMan,data=ttp)
publish(coxMan,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-left">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-left">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">smokeMan</td>
<td class="org-left">No</td>
<td class="org-left">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Yes</td>
<td class="org-left">0.82</td>
<td class="org-left">[0.63;1.08]</td>
<td class="org-left">0.154</td>
</tr>
</tbody>
</table>

<p>
Smoking of the man did not significantly increase the time to
pregnancy (hazard ratio=0.82, 95%-CI=[0.63;1.08], p=0.15).
</p>
</div>
</div>

<div id="outline-container-org9d1ee3c" class="outline-4">
<h4 id="org9d1ee3c">Interaction</h4>
<div class="outline-text-4" id="text-org9d1ee3c">
<div class="org-src-container">
<pre class="src src-R">coxInter <span style="color: #008b8b;">&lt;-</span> coxph(Surv(ttp,status)~smokeMan*smokeWoman,data=ttp,x=<span style="color: #228b22;">TRUE</span>)
summary(coxInter)
</pre>
</div>

<pre class="example">
Call:
coxph(formula = Surv(ttp, status) ~ smokeMan * smokeWoman, data = ttp, 
    x = TRUE)

  n= 423, number of events= 256 

                             coef exp(coef) se(coef)      z Pr(&gt;|z|)  
smokeManYes               -0.1178    0.8889   0.1869 -0.630   0.5285  
smokeWomanYes             -0.3695    0.6911   0.2192 -1.686   0.0918 .
smokeManYes:smokeWomanYes  0.1210    1.1287   0.3209  0.377   0.7061  
---
codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

                          exp(coef) exp(-coef) lower .95 upper .95
smokeManYes                  0.8889      1.125    0.6162     1.282
smokeWomanYes                0.6911      1.447    0.4497     1.062
smokeManYes:smokeWomanYes    1.1287      0.886    0.6018     2.117

Concordance= 0.536  (se = 0.017 )
Rsquare= 0.015   (max possible= 0.999 )
Likelihood ratio test= 6.31  on 3 df,   p=0.1
Wald test            = 6.01  on 3 df,   p=0.1
Score (logrank) test = 6.07  on 3 df,   p=0.1
</pre>


<div class="org-src-container">
<pre class="src src-R">publish(coxInter,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-right">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-right">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">smokeMan(No): smokeWoman(Yes vs No)</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">0.69</td>
<td class="org-left">[0.45;1.06]</td>
<td class="org-right">0.0918</td>
</tr>

<tr>
<td class="org-left">smokeMan(Yes): smokeWoman(Yes vs No)</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">0.78</td>
<td class="org-left">[0.49;1.23]</td>
<td class="org-right">0.2892</td>
</tr>

<tr>
<td class="org-left">smokeWoman(No): smokeMan(Yes vs No)</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">0.89</td>
<td class="org-left">[0.62;1.28]</td>
<td class="org-right">0.5285</td>
</tr>

<tr>
<td class="org-left">smokeWoman(Yes): smokeMan(Yes vs No)</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">1.00</td>
<td class="org-left">[0.60;1.67]</td>
<td class="org-right">0.9902</td>
</tr>
</tbody>
</table>

<p>
There is no significant effect modification. The hazard ratio for
non-smoking couples compared to smoking couples is:
</p>

<pre class="example">
exp(coef_1 + coef_2 + coef_3) = exp(-0.1178-0.3695+0.121)=
 0.8889 * 0.6911 * 1.1287 = 0.693
</pre>

<p>
This is similar to the hazard ratio for smoking woman compared to
non-smoking woman when the man is not smoking:
</p>

<pre class="example">
exp(coef_2) = exp(0.3695)= 0.6911
</pre>

<p>
The p-value is 0.7061.
</p>

<p>
We can obtain the comparison between both smoking and none smoking by
including the variable <code>coupleSmoking</code> (which has 4 levels):
</p>

<div class="org-src-container">
<pre class="src src-R">publish(coxph(Surv(ttp,status)~coupleSmoking,data=ttp),org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-right">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-right">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">coupleSmoking</td>
<td class="org-left">none</td>
<td class="org-right">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">woman only</td>
<td class="org-right">0.69</td>
<td class="org-left">[0.45;1.06]</td>
<td class="org-right">0.0918</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">man only</td>
<td class="org-right">0.89</td>
<td class="org-left">[0.62;1.28]</td>
<td class="org-right">0.5285</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">both</td>
<td class="org-right">0.69</td>
<td class="org-left">[0.49;0.99]</td>
<td class="org-right">0.0428</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org78d595f" class="outline-3">
<h3 id="org78d595f">Effect of alcohol (Cox regression)</h3>
<div class="outline-text-3" id="text-org78d595f">
</div>
<div id="outline-container-org8da31dd" class="outline-4">
<h4 id="org8da31dd">Continuous alcohol variable</h4>
<div class="outline-text-4" id="text-org8da31dd">
<div class="org-src-container">
<pre class="src src-R">coxDrink <span style="color: #008b8b;">&lt;-</span> coxph(Surv(ttp,status)~alcWoman,data=ttp)
publish(coxDrink,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-right">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-right">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">alcWoman</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">0.98</td>
<td class="org-left">[0.95;1.01]</td>
<td class="org-right">0.132</td>
</tr>
</tbody>
</table>


<p>
The effect of alcohol is not statistically significant (p=0.132) but
this model assumes that the relation between a unit change of alcohol
drinking behaviour (1 more beverage per week) and the hazard ratio is
linear. This assumption may be violated.
</p>

<div class="org-src-container">
<pre class="src src-R">ttp[,drinkWoman:=factor(cut(alcWoman,c(-1,0,10,100)),labels=c(<span style="color: #8b2252;">"no"</span>,<span style="color: #8b2252;">"moderate"</span>,<span style="color: #8b2252;">"high"</span>))]
coxDrink2 <span style="color: #008b8b;">&lt;-</span> coxph(Surv(ttp,status)~drinkWoman,data=ttp)
publish(coxDrink2,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-right">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-right">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">drinkWoman</td>
<td class="org-left">no</td>
<td class="org-right">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">moderate</td>
<td class="org-right">0.73</td>
<td class="org-left">[0.55;0.95]</td>
<td class="org-right">0.0214</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">high</td>
<td class="org-right">0.53</td>
<td class="org-left">[0.32;0.89]</td>
<td class="org-right">0.0163</td>
</tr>
</tbody>
</table>


<p>
The probability of pregnancy is significantly lower for women drinking
moderately as compared to women not drinking (hazard ratio: 0.73,
95%-CI: [0.55;0.95], p-value: 0.021) and for women drinking excessively
as compared to women not drinking (hazard ratio: 0.53, 95%-CI:
[0.32;0.89], p-value: 0.016).
</p>

<p>
The comparison of excessively to moderate is obtained by using relevel:
</p>

<div class="org-src-container">
<pre class="src src-R">ttp$drinkWoman2 <span style="color: #008b8b;">&lt;-</span> relevel(ttp$drinkWoman,<span style="color: #8b2252;">"moderate"</span>)
coxDrink3 <span style="color: #008b8b;">&lt;-</span> coxph(Surv(ttp,status)~drinkWoman2,data=ttp)
publish(coxDrink3,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-right">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-right">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">drinkWoman2</td>
<td class="org-left">moderate</td>
<td class="org-right">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">no</td>
<td class="org-right">1.38</td>
<td class="org-left">[1.05;1.81]</td>
<td class="org-right">0.0214</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">high</td>
<td class="org-right">0.73</td>
<td class="org-left">[0.45;1.19]</td>
<td class="org-right">0.2121</td>
</tr>
</tbody>
</table>

<p>
The probability of pregnancy is estimated as being lower, but not
statistically significantly lower, for women drinking excessively as
compared to women drinking moderately (hazard ratio: 0.73, 95%-CI:
[0.45;0.95], p-value: 0.21).
</p>
</div>
</div>

<div id="outline-container-orgdd164d2" class="outline-4">
<h4 id="orgdd164d2">Adjusted analyses</h4>
<div class="outline-text-4" id="text-orgdd164d2">
<div class="org-src-container">
<pre class="src src-R">coxDrink4 <span style="color: #008b8b;">&lt;-</span> coxph(Surv(ttp,status)~drinkWoman+smokeWoman,data=ttp)
publish(coxDrink4,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-right">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-right">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">drinkWoman</td>
<td class="org-left">no</td>
<td class="org-right">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">moderate</td>
<td class="org-right">0.76</td>
<td class="org-left">[0.58;1.00]</td>
<td class="org-right">0.0477</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">high</td>
<td class="org-right">0.55</td>
<td class="org-left">[0.33;0.92]</td>
<td class="org-right">0.0240</td>
</tr>

<tr>
<td class="org-left">smokeWoman</td>
<td class="org-left">No</td>
<td class="org-right">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Yes</td>
<td class="org-right">0.74</td>
<td class="org-left">[0.55;0.98]</td>
<td class="org-right">0.0381</td>
</tr>
</tbody>
</table>

<p>
After adjusting for smoking the results are similar as above.
</p>

<div class="org-src-container">
<pre class="src src-R">coxDrink5 <span style="color: #008b8b;">&lt;-</span> coxph(Surv(ttp,status)~drinkWoman+spermConc,data=ttp)
publish(coxDrink5,org=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Units</th>
<th scope="col" class="org-right">Missing</th>
<th scope="col" class="org-right">HazardRatio</th>
<th scope="col" class="org-left">CI.95</th>
<th scope="col" class="org-left">p-value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">drinkWoman</td>
<td class="org-left">no</td>
<td class="org-right">0</td>
<td class="org-right">Ref</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">moderate</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">0.68</td>
<td class="org-left">[0.51;0.91]</td>
<td class="org-left">0.00952</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">high</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">0.47</td>
<td class="org-left">[0.27;0.83]</td>
<td class="org-left">0.00881</td>
</tr>

<tr>
<td class="org-left">spermConc</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">113</td>
<td class="org-right">1.00</td>
<td class="org-left">[1.00;1.01]</td>
<td class="org-left">&lt; 0.001</td>
</tr>
</tbody>
</table>

<p>
After adjusting for sperm concentration the results become more
significant and the hazard ratios for group comparisons are more
extreme. The reasons are
</p>

<ol class="org-ol">
<li>sperm concentration is an important factor which when omitted leads
to a systematic underestimation of effects. Like in logistic
regression, this occurs even if the variable of interest (i.e. the
drinking behavior of the woman) is independent of the factor
(i.e. the sperm concentration).</li>
<li>sperm concentration is missing for 113 of the men. The default
behavior of the software is to remove all the data of all couples
where the sperm concentration is missing. This changes the data set
quite a lot and there may be a selection bias.</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
Last update: 23 Nov 2019 by Thomas Alexander Gerds.
</div>
</body>
</html>
